/*
 * LCD_functions.c
 *
 * Created: 2018-03-29 07:19:39
 *  Author: Spellabbet
 */ 

#include <asf.h>
#include "LCD_functions.h"
#include "common.h"
#include "delay.h"

static const uint8_t CHARS[][5] = {
	 {0x00, 0x00, 0x00, 0x00, 0x00}, // 20
	 {0x00, 0x00, 0x5f, 0x00, 0x00}, // 21 !
	 {0x00, 0x07, 0x00, 0x07, 0x00}, // 22 "
	 {0x14, 0x7f, 0x14, 0x7f, 0x14}, // 23 #
	 {0x24, 0x2a, 0x7f, 0x2a, 0x12}, // 24 $
	 {0x23, 0x13, 0x08, 0x64, 0x62}, // 25 %
	 {0x36, 0x49, 0x55, 0x22, 0x50}, // 26 &
	 {0x00, 0x05, 0x03, 0x00, 0x00}, // 27 '
	 {0x00, 0x1c, 0x22, 0x41, 0x00}, // 28 (
	 {0x00, 0x41, 0x22, 0x1c, 0x00}, // 29 )
	 {0x14, 0x08, 0x3e, 0x08, 0x14}, // 2a *
	 {0x08, 0x08, 0x3e, 0x08, 0x08}, // 2b +
	 {0x00, 0x50, 0x30, 0x00, 0x00}, // 2c ,
	 {0x08, 0x08, 0x08, 0x08, 0x08}, // 2d -
	 {0x00, 0x60, 0x60, 0x00, 0x00}, // 2e .
	 {0x20, 0x10, 0x08, 0x04, 0x02}, // 2f /
	 {0x3e, 0x51, 0x49, 0x45, 0x3e}, // 30 0
	 {0x00, 0x42, 0x7f, 0x40, 0x00}, // 31 1
	 {0x42, 0x61, 0x51, 0x49, 0x46}, // 32 2
	 {0x21, 0x41, 0x45, 0x4b, 0x31}, // 33 3
	 {0x18, 0x14, 0x12, 0x7f, 0x10}, // 34 4
	 {0x27, 0x45, 0x45, 0x45, 0x39}, // 35 5
	 {0x3c, 0x4a, 0x49, 0x49, 0x30}, // 36 6
	 {0x01, 0x71, 0x09, 0x05, 0x03}, // 37 7
	 {0x36, 0x49, 0x49, 0x49, 0x36}, // 38 8
	 {0x06, 0x49, 0x49, 0x29, 0x1e}, // 39 9
	 {0x00, 0x36, 0x36, 0x00, 0x00}, // 3a :
	 {0x00, 0x56, 0x36, 0x00, 0x00}, // 3b ;
	 {0x08, 0x14, 0x22, 0x41, 0x00}, // 3c <
	 {0x14, 0x14, 0x14, 0x14, 0x14}, // 3d =
	 {0x00, 0x41, 0x22, 0x14, 0x08}, // 3e >
	 {0x02, 0x01, 0x51, 0x09, 0x06}, // 3f ?
	 {0x32, 0x49, 0x79, 0x41, 0x3e}, // 40 @
	 {0x7e, 0x11, 0x11, 0x11, 0x7e}, // 41 A
	 {0x7f, 0x49, 0x49, 0x49, 0x36}, // 42 B
	 {0x3e, 0x41, 0x41, 0x41, 0x22}, // 43 C
	 {0x7f, 0x41, 0x41, 0x22, 0x1c}, // 44 D
	 {0x7f, 0x49, 0x49, 0x49, 0x41}, // 45 E
	 {0x7f, 0x09, 0x09, 0x09, 0x01}, // 46 F
	 {0x3e, 0x41, 0x49, 0x49, 0x7a}, // 47 G
	 {0x7f, 0x08, 0x08, 0x08, 0x7f}, // 48 H
	 {0x00, 0x41, 0x7f, 0x41, 0x00}, // 49 I
	 {0x20, 0x40, 0x41, 0x3f, 0x01}, // 4a J
	 {0x7f, 0x08, 0x14, 0x22, 0x41}, // 4b K
	 {0x7f, 0x40, 0x40, 0x40, 0x40}, // 4c L
	 {0x7f, 0x02, 0x0c, 0x02, 0x7f}, // 4d M
	 {0x7f, 0x04, 0x08, 0x10, 0x7f}, // 4e N
	 {0x3e, 0x41, 0x41, 0x41, 0x3e}, // 4f O
	 {0x7f, 0x09, 0x09, 0x09, 0x06}, // 50 P
	 {0x3e, 0x41, 0x51, 0x21, 0x5e}, // 51 Q
	 {0x7f, 0x09, 0x19, 0x29, 0x46}, // 52 R
	 {0x46, 0x49, 0x49, 0x49, 0x31}, // 53 S
	 {0x01, 0x01, 0x7f, 0x01, 0x01}, // 54 T
	 {0x3f, 0x40, 0x40, 0x40, 0x3f}, // 55 U
	 {0x1f, 0x20, 0x40, 0x20, 0x1f}, // 56 V
	 {0x3f, 0x40, 0x38, 0x40, 0x3f}, // 57 W
	 {0x63, 0x14, 0x08, 0x14, 0x63}, // 58 X
	 {0x07, 0x08, 0x70, 0x08, 0x07}, // 59 Y
	 {0x61, 0x51, 0x49, 0x45, 0x43} // 5a Z
	};

static const uint8_t CMDS[6] = {0x21, 0x13, 0xC0, 0x04, 0x20, 0x0C};

void LCDWriteByte(uint8_t d)
{
	uint8_t t = d;
	
	CLR_BIT(PORTB, 6);
	int i;
	for(i = 0; i < 8; i++) 
	{
		uint8_t b = 0x80;
		b = t & b;
	
		if(b != 0) SET_BIT(PORTH, 6);
		CLR_BIT(PORTH, 6);
		
		SET_BIT(PORTH, 5);
		delay_1_micros();
		CLR_BIT(PORTH, 5);
		
		t = t << 1;
	}
	
	SET_BIT(PORTB, 6);
}

void LCDWriteCommand(uint8_t d)
{
	CLR_BIT(PORTB, 4);
	LCDWriteByte(d);
}

void LCDWriteChr(char d)
{
	int i;
	int j;
	for(i = 0; i < 10; i++) delay_1_micros();
	SET_BIT(PORTB, 4);
	char t = (d - OFFSET)*CHR_WIDTH;
	for(i = 0; i < 5; i++)
	{
		for(j = 0; j < 20; j++) delay_1_micros();
		LCDWriteByte(CHARS[t, i]);
	}
}

void LCDInit()
{
	int i = 0;
	for(i = 0; i < 20; i++) delay_1_micros();
	SET_BIT(PORTB, 5);
	for(i = 0; i < 10; i++) delay_1_micros();
	SET_BIT(PORTB, 6);
	for(i = 0; i < 6; i++) LCDWriteCommand(CMDS[i]);
}